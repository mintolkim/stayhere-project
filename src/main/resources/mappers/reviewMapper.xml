<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 다른 mapper와 중복되지 않도록 네임스페이스 기재 -->
<mapper namespace="review">
	<select id="listAll"
		resultType="com.example.stayhere.model.review.dto.ReviewDTO">
		select review_idx, r_title, review_star, review_content,
		userid, write_date, view_count
		from review
		order by review_idx desc
	</select>
	
	<!-- 숙소 상세 페이지 내의 해당 숙소 리뷰 목록 -->
	<select id="reviewsByRoom" resultType="com.example.stayhere.model.review.dto.ReviewDTO">
    select *
		from (
			select 
                room_idx, 
                review_idx, 
                r.userid, 
                write_date, 
                r_title, 
                review_content, 
                review_star,
                g.profile_img
			from review r join guest g 
			on r.userid = g.userid
		) where room_idx=#{room_idx} order by review_idx desc
	</select>
	
	<!-- 숙소 별 리뷰 개수 -->
	<select id="countByRoom" resultType="int">
		select count(*) from review
		where room_idx=#{room_idx}
	</select>
	
	<!-- 숙소 별 별점 평균 -->
	<select id="starByRoom" resultType="double">
		select nvl(round(avg(review_star), 2),0.0) from review
		where room_idx=#{room_idx}
	</select>
	
</mapper>














